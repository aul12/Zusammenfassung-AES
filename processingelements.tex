\chapter{Processing Elements}
\section{Instruction Set Processor (ISP)}
\subsection{von-Neumann-/Princeton-Architektur}
$ $%Forcing a new page
\begin{figure}[H]
    \centering
    \begin{tikzpicture}
        \filldraw [draw=black,fill=gray!10] (-1,7) rectangle (10,15);
        \filldraw [draw=black,fill=gray!40] (0,0) rectangle (4,6);
        \filldraw [draw=black,fill=gray!40] (0,8) rectangle (4,14);
        \filldraw [draw=black,fill=gray!40] (5,8) rectangle (9,14);
        \filldraw [draw=black,fill=gray!70] (0.5,9) rectangle (3.5,13);
        \filldraw [draw=black,fill=gray!70] (5.5,11.5) rectangle (8.5,13);
        \filldraw [draw=black,fill=gray!70] (5.5,9) rectangle (8.5,10.5);
        \filldraw [draw=black,fill=gray!70] (5,5) rectangle (6,6);
        \filldraw [draw=black,fill=gray!70] (-2,5) rectangle (-1,6);
        \filldraw [draw=black,fill=gray!70] (0,6) rectangle (4,5);
        \filldraw [draw=black,fill=gray!70] (0,5) rectangle (4,4);
        \filldraw [draw=black,fill=gray!70] (0,0) rectangle (4,1);
        \draw (-1,15) node[above right] {Prozessor};
        \draw (0,14) node[above right] {Steuerwerk};
        \draw (5,14) node[above right] {Rechenwerk};
        \draw (0,6) node[above right] {Speicher};
        \draw (0.5,13) node[above right] {Kontrollpfad};
        \draw (0.5,13) node[below right] {Zustands-};
        \draw (0.5,12.5) node[below right] {Register};
        \draw (5.5,13) node[above right] {Datenpfad};
        \draw (5.5,13) node[below right] {ALU};
        \draw (5.5,10.5) node[below right] {Register};
        \draw (5,6) node[below right] {IR};
        \draw (-2,6) node[below right] {PC};
        \draw (0,6) node[below right] {Programm};
        \draw (0,5) node[below right] {Stack};
        \draw (0,1) node[below right] {Daten};
        \draw [->] (4,12) -- (5,12);
        \draw [->] (5,10) -- (4,10);
        \draw [->] (7,2.5) -- (4,2.5);
        \draw [->] (7,2.5) -- (7,8);
        \draw [->] (4,5.5) -- (5,5.5);
        \draw (5.5,6) |- (3,6.5);
        \draw [->] (3,6.5) |- (3,8);
        \draw [->] (-1,5.5) -- (0,5.5);
        \draw (-1.5,6) |- (1,6.5);
        \draw [->] (1,6.5) |- (1,8);
    \end{tikzpicture}
    \caption{Aufbau eines von-Neumann Prozessors}
\end{figure}
\subsection{Befehlszyklus}
\begin{enumerate}
    \item Befehl holen (fetch)
    \item Befehl dekodieren (decode)
    \item Operanden holen (load)
    \item Befehl ausführen (execute)
    \item Daten speichern (write back)
\end{enumerate}

\begin{table}[H]
    \centering
    \begin{tabular}{p{.5\textwidth}p{.5\textwidth}}
        \toprule
        Pro & Contra \\
        \midrule
        Analyse einfach & Auslastung gering \\
        Speicher flexibel benutzbar & von-Neumann Flaschenhals (Daten und Befehle über den selben Bus)\\
        \bottomrule
    \end{tabular}
\end{table}

\subsection{Harvard-Architektur}
\begin{figure}[H]
    \centering
    \begin{tikzpicture}
        \filldraw [draw=black,fill=gray!10] (-1,7) rectangle (10,15);
        \filldraw [draw=black,fill=gray!40] (0,0) rectangle (4,6);
        \filldraw [draw=black,fill=gray!40] (0,8) rectangle (4,14);
        \filldraw [draw=black,fill=gray!40] (5,8) rectangle (9,14);
        \filldraw [draw=black,fill=gray!40] (5,0) rectangle (9,4);
        \filldraw [draw=black,fill=gray!70] (0.5,9) rectangle (3.5,13);
        \filldraw [draw=black,fill=gray!70] (5.5,11.5) rectangle (8.5,13);
        \filldraw [draw=black,fill=gray!70] (5.5,9) rectangle (8.5,10.5);
        \filldraw [draw=black,fill=gray!70] (5,5) rectangle (6,6);
        \filldraw [draw=black,fill=gray!70] (-2,5) rectangle (-1,6);
        \filldraw [draw=black,fill=gray!70] (0,6) rectangle (4,5);
        \filldraw [draw=black,fill=gray!70] (5,4) rectangle (9,3);
        \filldraw [draw=black,fill=gray!70] (5,0) rectangle (9,1);
        \draw (-1,15) node[above right] {Prozessor};
        \draw (0,14) node[above right] {Steuerwerk};
        \draw (5,14) node[above right] {Rechenwerk};
        \draw (0,6) node[above right] {Speicher};
        \draw (0.5,13) node[above right] {Kontrollpfad};
        \draw (0.5,13) node[below right] {Zustands-};
        \draw (0.5,12.5) node[below right] {Register};
        \draw (5.5,13) node[above right] {Datenpfad};
        \draw (5.5,13) node[below right] {ALU};
        \draw (5.5,10.5) node[below right] {Register};
        \draw (5,6) node[below right] {IR};
        \draw (-2,6) node[below right] {PC};
        \draw (0,6) node[below right] {Programm};
        \draw (5,4) node[below right] {Stack};
        \draw (5,1) node[below right] {Daten};
        \draw [->] (4,12) -- (5,12);
        \draw [->] (5,10) -- (4,10);
        \draw [<->] (7,4) -- (7,8);
        \draw [->] (4,5.5) -- (5,5.5);
        \draw (5.5,6) |- (3,6.5);
        \draw [->] (3,6.5) |- (3,8);
        \draw [->] (-1,5.5) -- (0,5.5);
        \draw (-1.5,6) |- (1,6.5);
        \draw [->] (1,6.5) |- (1,8);
    \end{tikzpicture}
    \caption{Aufbau eines Harvard Prozessors}
\end{figure}
\begin{table}[H]
    \centering
    \begin{tabular}{p{.5\textwidth}p{.5\textwidth}}
        \toprule
        Pro & Contra \\
        \midrule
        Auslastung & Fragmentierter Speicher \\
        Kein Flaschenhals & Analyse schwierig \\
        Schnellere Abarbeitung & Schwierig bei Datenabhängigkeiten \\
        \bottomrule
    \end{tabular}
\end{table}

\section{Application Specific Instruction Set Processor (ASIP)}
Regulärer ISP wird durch zusätzliche Instruktionen (und damit auch Hardware) für ein bestimmtes Einsatzgebiet optimiert, 
z.B. durch zusätzlich \glqq{}Multiply-Accumulate\grqq{}-Einheit oder auch komplette FFT-Operationen.
Beispiel: DSP (Digital Signal Processpr).
\begin{figure}[H]
    \centering
    \begin{tikzpicture}
        \filldraw [draw=black,fill=gray!10] (-1,7) rectangle (10,15);
        \filldraw [draw=black,fill=gray!40] (0,8) rectangle (4,14);
        \filldraw [draw=black,fill=gray!40] (5,8) rectangle (9,14);
        \filldraw [draw=black,fill=gray!70] (0.5,9) rectangle (3.5,13);
        \filldraw [draw=black,fill=gray!70] (5.5,12) rectangle (8.5,13);
        \filldraw [draw=black,fill=gray!70] (5.5,10.5) rectangle (8.5,11.5);
        \filldraw [draw=black,fill=gray!70] (5.5,9) rectangle (8.5,10);
        \draw (-1,15) node[above right] {ASIP};
        \draw (0,14) node[above right] {Steuerwerk};
        \draw (5,14) node[above right] {Rechenwerk};
        \draw (0.5,13) node[above right] {Kontrollpfad};
        \draw (0.5,13) node[below right] {Zustands-};
        \draw (0.5,12.5) node[below right] {Register};
        \draw (5.5,13) node[above right] {Datenpfad};
        \draw (5.5,13) node[below right] {ALU};
        \draw (5.5,11.5) node[below right] {MAC-Einheit};
        \draw (5.5,10) node[below right] {Register};
        \draw [->] (4,12) -- (5,12);
        \draw [->] (5,10) -- (4,10);
    \end{tikzpicture}
    \caption{Aufbau eines ASIP mit zusätzlicher MAC-Einheit}
\end{figure}

\section{Application Specific Processor}
Nicht mehr programmierbar, Prozessor kann nur wenige vorkonfigurierte Befehle ausführen, Steuerung erfolgt über eine spezielle Logik, oftmals in Form einer
State-Machine.
\begin{figure}[H]
    \centering
    \begin{tikzpicture}
        \filldraw [draw=black,fill=gray!10] (-1,7) rectangle (10,15);
        \filldraw [draw=black,fill=gray!40] (0,8) rectangle (4,14);
        \filldraw [draw=black,fill=gray!40] (5,8) rectangle (9,14);
        \filldraw [draw=black,fill=gray!70] (0.5,9) rectangle (3.5,13);
        \filldraw [draw=black,fill=gray!70] (5.5,12) rectangle (8.5,13);
        \filldraw [draw=black,fill=gray!70] (5.5,10.5) rectangle (8.5,11.5);
        \filldraw [draw=black,fill=gray!70] (5.5,9) rectangle (8.5,10);
        \draw (-1,15) node[above right] {ASP};
        \draw (0,14) node[above right] {Steuerwerk};
        \draw (5,14) node[above right] {Rechenwerk};
        \draw (0.5,13) node[above right] {Kontrollpfad};
        \draw (0.5,13) node[below right] {Zustands-};
        \draw (0.5,12.5) node[below right] {Maschine};
        \draw (5.5,13) node[above right] {Datenpfad};
        \draw (5.5,13) node[below right] {FFT};
        \draw (5.5,11.5) node[below right] {+};
        \draw (5.5,10) node[below right] {-};
        \draw [->] (4,12) -- (5,12);
        \draw [->] (5,10) -- (4,10);
    \end{tikzpicture}
    \caption{Aufbau eines ASP, der nur FFT,+ und - Operationen durchführt}
\end{figure}

\section{Beispiel: Aufbau eines Schnurlosen DECT-Telefons}
\begin{figure}[H]
    \centering
    \begin{tikzpicture}
        \filldraw [draw=black,fill=gray!10] (5,0) rectangle (3,2) 
            node[below right,max width=2cm] {\textbf{ASP}\\(Codierung)};
        \filldraw [draw=black,fill=gray!10] (8,0) rectangle (6,2)
            node[below right,max width=2cm] {Dualband\\RAM};
        \filldraw [draw=black,fill=gray!10] (5,3) rectangle (3,5)
            node[below right,max width=2cm] {\textbf{ISP}\\HMI\\Protokolle};
        \filldraw [draw=black,fill=gray!10] (8,3) rectangle (6,5)
            node[below right,max width=2cm] {\textbf{ASP}\\Burstmode-Logic};
        \filldraw [draw=black,fill=gray!10] (11,3) rectangle (9,5)
            node[below right,max width=2cm] {Radio};
        \filldraw [draw=black,fill=gray!10] (2,5) rectangle (1,3)
            node[below right,max width=2cm,rotate=90] {Speicher};
        \filldraw [draw=black,fill=gray!10] (2,2) rectangle (1,0)
            node[below right,max width=2cm,rotate=90] {Lautsprecher\\Mikrofon};
        \draw (11,4) to[short] (12,4) node[antenna]{};
        \draw [<->] (2,1) -- (3,1);
        \draw [<->] (2,4) -- (3,4);
        \draw [<->] (5,0.5) -- (6,0.5);
        \draw [<->] (8,4) -- (9,4);
        \draw [<->] (7,2) -- (7,3);
        \draw [<-] (5,4) -| (5.5,2.5);
        \draw [->] (5.5,2.5) |- (6,1.5);
    \end{tikzpicture}
    \caption{Beispielhafter Aufbau eines DECT-Telefons}
\end{figure}
Oftmals wird ein ISP mit zugehöriger RF-Hardware auf einem Chip-Integriert (z.B. in Mobiltelefonen), dann spricht man von einem Sytem-on-a-Chip (SoC).

\section{Wie kommunizieren PEs in heterogenen Systemen?}
\subsection{Gemeinsame Ressourcen (Speicherkopplung)}
\begin{figure}[H]
    \centering
    \begin{tikzpicture}
        \filldraw [draw=black,fill=gray!10] (2,0) rectangle (0,2) 
            node[below right,max width=2cm] {Arbiter};
        \filldraw [draw=black,fill=gray!10] (7,0) rectangle (5,2)
            node[below right,max width=2cm] {Speicher};
        \filldraw [draw=black,fill=gray!10] (2,3) rectangle (0,5)
            node[below right,max width=2cm] {ISP};
        \filldraw [draw=black,fill=gray!10] (7,3) rectangle (5,5)
            node[below right,max width=2cm] {ISP};
        \filldraw [draw=black, fill=gray!10]
            (3,0) -- (3,5) -- (3.5,6) -- (4,5) -- (4,0) -- (3.5,-1) -- cycle;
        \draw (3.5,2.5) node[rotate=90] (){Bus};
        \draw [<->] (2,1) -- (3,1);
        \draw [<->] (2,4) -- (3,4);
        \draw [<->] (4,1) -- (5,1);
        \draw [<->] (4,4) -- (5,4);
    \end{tikzpicture}
    \caption{Beispielhafter Aufbau eines Systems mit Speicherkopplung}
\end{figure}
Alle PEs können über einen Bus auf eine gemeinsame Ressource (für gewöhnlich Speicher) zugreifen. 
Für die Synchronisation ist ein \glqq{}Arbiter\grqq{} (Richter) sowie ein Bus-Controller in jedem PE notwendig.

\subsection{Direkte Verbindung}
Direkte Verbindung zwischen allen PEs die kommunizieren müssen, Arbitrierung ist nicht notwendig, mehrere PEs können gleichzeitig kommunizieren. 
Es ist wieder ein Controller für jede Verbindung von nöten, zudem muss dieser eventuell Daten puffern. 
Bei $n$ PEs sind im Worstcase $\frac{(n-1)\cdot n}{2} \in  \mathcal{O}(n^2)$ Verbindung notwendig.

\subsection{Tiled-Architecture}
Bei einer Tiled-Architecture oder Network-on-a-Chip (NOC) werden jeweils wenige PEs über eine gemeinsame Resource verbunden. 
Diese Gruppen an PEs werden dann über ein Gitter aus Leitungen verbunden.
\begin{figure}[H]
    \centering
    \begin{tikzpicture}[scale=0.8]
        \filldraw [draw=black,fill=gray!10] (-0.5,-1) rectangle (4,3.5);
        \filldraw [draw=black,fill=gray!10] (-0.5,5.5) rectangle (4,10);
        \filldraw [draw=black,fill=gray!10] (6,5.5) rectangle (10.5,10);
        \filldraw [draw=black,fill=gray!10] (6,-1) rectangle (10.5,3.5);
        \filldraw [draw=black,fill=gray!40] (1,0) rectangle (0,1);
        \filldraw [draw=black,fill=gray!40] (3.5,0) rectangle (2.5,1);
        \filldraw [draw=black,fill=gray!40] (1,1.5) rectangle (0,2.5);
        \filldraw [draw=black,fill=gray!40] (3.5,1.5) rectangle (2.5,2.5);
        \filldraw [draw=black,fill=gray!40]
            (1.5,0) -- (1.5,2.5) -- (1.75,3) -- (2,2.5) -- (2,0) -- (1.75,-0.5) -- cycle;
        \draw [<->] (1,0.5) -- (1.5,0.5);
        \draw [<->] (1,2) -- (1.5,2);
        \draw [<->] (2,0.5) -- (2.5,0.5);
        \draw [<->] (2,2) -- (2.5,2);
        \draw (5,-3) -- (5,12);
        \draw (-1.5,-3) -- (-1.5,12);
        \draw (11.5,-3) -- (11.5,12);
        \draw (-2.5,-2) -- (12.5,-2);
        \draw (-2.5,4.5) -- (12.5,4.5);
        \draw (-2.5,11) -- (12.5,11);
        \foreach \x in {-1.5,5,11.5}{
            \foreach \y in {-2,4.5,11}{
                \draw (\x,\y) circle (0.1cm);
            }
        }
        \foreach \x in {-1.5,5}{
            \foreach \y in {-2,4.5}{
                \draw (\x,\y) -- (\x+1,\y+1);
            }
        }
    \end{tikzpicture}
    \caption{Beispielhafter Aufbau eines Systems mit Tiled-Architecture}
\end{figure}
